apiVersion: v1
kind: Pod
metadata:
  name: jenkins-rsync
spec:
  restartPolicy: Never
  containers:
    - name: copy
      image: alpine:3.20
      command: ["/bin/sh","-c"]
      args:
        - |
          set -e
          apk add --no-cache rsync
          echo "?? Count jobs (source):"
          find -P /old/jobs -type f -name config.xml | wc -l
          echo "?? Source preview:"
          ls -la /old | head -n 40
          echo "?? Rsync (archive, preserve attrs, no symlink deref)..."
          # Trailing slashes are important to copy CONTENTS of /old into /new
          rsync -aH /old/ /new/
          echo "?? Count jobs (destination):"
          find -P /new/jobs -type f -name config.xml | wc -l
          echo "? RSYNC_DONE"
          sleep 2
      volumeMounts:
        - name: old
          mountPath: /old
        - name: new
          mountPath: /new
  volumes:
    - name: old
      hostPath:
        path: /jenkins-home     # <-- your confirmed old Jenkins home in Minikube
        type: Directory
    - name: new
      persistentVolumeClaim:
        claimName: jenkins-home # <-- your PVC name
